name: Setup Opened PR

on:
  pull_request:
    types: [opened, reopened]

jobs:
  add-reviews:
    runs-on: ubuntu-latest
    outputs:
      assigned-reviewers: ${{ steps.get-assigned-reviewers.outputs.reviewers }}
    steps:
      - name: Frontend Review Assignment
        uses: kentaro-m/auto-assign-action@v2.0.0
        with:
          configuration-path: ".github/auto_assign_frontend.yml"

      - name: Get Assigned Reviewers
        id: get-assigned-reviewers
        uses: actions/github-script@v6
        with:
          script: |
            const { data: pr } = await github.rest.pulls.get({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.issue.number
            });

            const reviewers = pr.requested_reviewers.map(reviewer => reviewer.login);
            console.log('Assigned reviewers:', reviewers);

            core.setOutput('reviewers', reviewers.join(','));

      - name: Send notification to Discord
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          TITLE="${{ github.event.pull_request.title }}"
          AUTHOR="${{ github.event.pull_request.user.login }}"
          URL="${{ github.event.pull_request.html_url }}"

          curl -X POST \
            -H "Content-Type: application/json" \
            -d "{
              \"username\": \"FE Bot\",
              \"embeds\": [
                {
                  \"title\": \"${TITLE}\",
                  \"url\": \"${URL}\",
                  \"color\": 16753920,
                  \"fields\": [
                    {
                      \"name\": \"ì‘ì„±ì\",
                      \"value\": \"${AUTHOR}\",
                      \"inline\": true
                    }
                  ],
                  \"footer\": {
                    \"text\": \"ì‘ì€ ë¦¬ë·° í•˜ë‚˜ê°€ í° ê°œì„ ì´ ë©ë‹ˆë‹¤ ğŸ™Œ\"
                  }
                }
              ]
            }" \
            "$DISCORD_WEBHOOK_URL"
